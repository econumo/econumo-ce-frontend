(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["LilTag"]=t():e["LilTag"]=t()})(this,(()=>(()=>{"use strict";var e={};return(()=>{var t,o,n=e;
/*!***********************!*\
  !*** ./src/liltag.ts ***!
  \***********************/Object.defineProperty(n,"__esModule",{value:!0}),function(e){e["PageLoad"]="pageLoad",e["DomReady"]="domReady",e["TimeDelay"]="timeDelay",e["ElementVisible"]="elementVisible",e["CustomEvent"]="customEvent"}(t||(t={})),function(e){e["Head"]="head",e["BodyTop"]="bodyTop",e["BodyBottom"]="bodyBottom"}(o||(o={}));class i{constructor(e){this.config=e,this.cacheEnabled=!1,this.cacheTTL=i.CACHE_DEFAULT_TTL}enableCache(e=i.CACHE_DEFAULT_TTL){if(e<=0)return console.warn(`LilTag cache TTL must be a positive number (${e} provided). Disabling cache.`),void(this.cacheEnabled=!1);this.cacheEnabled=!0,this.cacheTTL=e}init(){if(""!==this.config)if("string"===typeof this.config){if(this.cacheEnabled){const e=this.getCachedConfig(this.config);if(e)return console.log("Using cached configuration."),void this.processConfig(e)}this.fetchAndCacheConfig(this.config)}else this.processConfig(this.config);else console.warn("LilTag initialization skipped: empty string provided.")}fetchAndCacheConfig(e){fetch(e).then((e=>{if(!e.ok)throw new Error(`Network response was not ok (${e.statusText})`);return e.json()})).then((t=>{this.cacheEnabled&&this.cacheConfig(e,t),this.processConfig(t)})).catch((e=>console.error("Error loading configuration:",e)))}cacheConfig(e,t){const o=this.getCacheData();o[e]={config:t,timestamp:Date.now()},localStorage.setItem(i.CACHE_KEY,JSON.stringify(o))}getCachedConfig(e){const t=this.getCacheData(),o=t[e];if(!o)return null;const n=1e3*this.cacheTTL;return Date.now()-o.timestamp>n?(delete t[e],localStorage.setItem(i.CACHE_KEY,JSON.stringify(t)),null):o.config}getCacheData(){const e=localStorage.getItem(i.CACHE_KEY);if(e)try{return JSON.parse(e)}catch(e){return console.error("Error parsing cache data:",e),localStorage.removeItem(i.CACHE_KEY),{}}return{}}processConfig(e){e.tags.forEach((e=>{switch(e.trigger){case t.PageLoad:"complete"===document.readyState?this.executeTag(e):window.addEventListener("load",(()=>this.executeTag(e)));break;case t.DomReady:"interactive"===document.readyState||"complete"===document.readyState?this.executeTag(e):document.addEventListener("DOMContentLoaded",(()=>this.executeTag(e)));break;case t.TimeDelay:if(void 0!==e.delay){const t=Number(e.delay);isNaN(t)||t<0?console.warn(`Invalid delay value for tag "${e.id}". Skipping execution.`):setTimeout((()=>this.executeTag(e)),t)}else console.warn(`No delay specified for TimeDelay trigger in tag "${e.id}". Skipping execution.`);break;case t.ElementVisible:if(e.selector){const t=new IntersectionObserver(((t,o)=>{t.forEach((t=>{t.isIntersecting&&(this.executeTag(e),o.disconnect())}))}));document.querySelectorAll(e.selector).forEach((e=>t.observe(e)))}else console.warn(`No selector specified for ElementVisible trigger in tag "${e.id}".`);break;case t.CustomEvent:if(e.eventName){const t=()=>{this.executeTag(e),document.removeEventListener(e.eventName,t)};document.addEventListener(e.eventName,t)}else console.warn(`No eventName specified for CustomEvent trigger in tag "${e.id}".`);break;default:console.warn(`Unknown trigger type: ${e.trigger}`)}}))}executeTag(e){try{this.injectContent(e.content,e.location,e.id)}catch(t){console.error(`Error executing tag "${e.id}":`,t)}}injectContent(e,t,n){if(!e)return void console.warn(`Tag with ID "${n}" has no content to inject.`);const a=document.createElement("div");a.innerHTML=e.trim();const c=document.createDocumentFragment();switch(a.childNodes.forEach((e=>{const t=e.cloneNode(!0);if(t.nodeType===Node.ELEMENT_NODE){const e=t;if(e.setAttribute(i.DATA_ATTRIBUTE,n),"script"===e.tagName.toLowerCase()){const t=document.createElement("script");Array.from(e.attributes).forEach((e=>{t.setAttribute(e.name,e.value)})),t.text=e.textContent||"",c.appendChild(t)}else c.appendChild(e)}else c.appendChild(t)})),t){case o.Head:document.head.appendChild(c);break;case o.BodyTop:document.body.insertBefore(c,document.body.firstChild);break;case o.BodyBottom:document.body.appendChild(c);break;default:console.warn(`Unknown location "${t}" - defaulting to body bottom.`),document.body.appendChild(c)}}}i.DATA_ATTRIBUTE="data-tag-id",i.CACHE_KEY="LILTAG_CACHE",i.CACHE_DEFAULT_TTL=3600,n["default"]=i})(),e=e["default"],e})()));